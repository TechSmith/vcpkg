diff --git a/glib/glib-autocleanups.h b/glib/glib-autocleanups.h
index 1edbe2b..7393efe 100644
--- a/glib/glib-autocleanups.h
+++ b/glib/glib-autocleanups.h
@@ -44,19 +44,25 @@ G_GNUC_BEGIN_IGNORE_DEPRECATIONS
 /* If adding a cleanup here, please also add a test case to
  * glib/tests/autoptr.c
  */
+
+G_DEFINE_AUTOPTR_CLEANUP_FUNC(GList, g_list_free)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC(GThread, g_thread_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC(GBytes, g_bytes_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC(GHashTable, g_hash_table_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC(GSList, g_slist_free)
+
+#ifndef __EMSCRIPTEN__
+
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GAsyncQueue, g_async_queue_unref)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GBookmarkFile, g_bookmark_file_free)
-G_DEFINE_AUTOPTR_CLEANUP_FUNC(GBytes, g_bytes_unref)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GChecksum, g_checksum_free)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GDateTime, g_date_time_unref)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GDate, g_date_free)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GDir, g_dir_close)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GError, g_error_free)
-G_DEFINE_AUTOPTR_CLEANUP_FUNC(GHashTable, g_hash_table_unref)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GHmac, g_hmac_unref)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GIOChannel, g_io_channel_unref)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GKeyFile, g_key_file_unref)
-G_DEFINE_AUTOPTR_CLEANUP_FUNC(GList, g_list_free)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GArray, g_array_unref)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GPtrArray, g_ptr_array_unref)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GByteArray, g_byte_array_unref)
@@ -75,11 +81,9 @@ G_DEFINE_AUTO_CLEANUP_CLEAR_FUNC(GQueue, g_queue_clear)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GRand, g_rand_free)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GScanner, g_scanner_destroy)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GSequence, g_sequence_free)
-G_DEFINE_AUTOPTR_CLEANUP_FUNC(GSList, g_slist_free)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GString, g_autoptr_cleanup_gstring_free)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GStringChunk, g_string_chunk_free)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GStrvBuilder, g_strv_builder_unref)
-G_DEFINE_AUTOPTR_CLEANUP_FUNC(GThread, g_thread_unref)
 G_DEFINE_AUTO_CLEANUP_CLEAR_FUNC(GMutex, g_mutex_clear)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GMutexLocker, g_mutex_locker_free)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC(GRecMutexLocker, g_rec_mutex_locker_free)
@@ -102,4 +106,6 @@ G_DEFINE_AUTOPTR_CLEANUP_FUNC(GUri, g_uri_unref)
 G_DEFINE_AUTOPTR_CLEANUP_FUNC (GPathBuf, g_path_buf_free)
 G_DEFINE_AUTO_CLEANUP_CLEAR_FUNC (GPathBuf, g_path_buf_clear)
 
+#endif /* __EMSCRIPTEN__ */
+
 G_GNUC_END_IGNORE_DEPRECATIONS
diff --git a/glib/glib.h b/glib/glib.h
index d9b4e34..219d761 100644
--- a/glib/glib.h
+++ b/glib/glib.h
@@ -29,79 +29,27 @@
 
 #define __GLIB_H_INSIDE__
 
-#include <glib/galloca.h>
-#include <glib/garray.h>
+#ifndef __EMSCRIPTEN__
+
 #include <glib/gasyncqueue.h>
-#include <glib/gatomic.h>
 #include <glib/gbacktrace.h>
 #include <glib/gbase64.h>
-#include <glib/gbitlock.h>
-#include <glib/gbookmarkfile.h>
-#include <glib/gbytes.h>
-#include <glib/gcharset.h>
-#include <glib/gchecksum.h>
-#include <glib/gconvert.h>
-#include <glib/gdataset.h>
-#include <glib/gdate.h>
-#include <glib/gdatetime.h>
-#include <glib/gdir.h>
-#include <glib/genviron.h>
-#include <glib/gerror.h>
-#include <glib/gfileutils.h>
-#include <glib/ggettext.h>
-#include <glib/ghash.h>
 #include <glib/ghmac.h>
-#include <glib/ghook.h>
 #include <glib/ghostutils.h>
-#include <glib/giochannel.h>
-#include <glib/gkeyfile.h>
-#include <glib/glist.h>
-#include <glib/gmacros.h>
-#include <glib/gmain.h>
-#include <glib/gmappedfile.h>
-#include <glib/gmarkup.h>
-#include <glib/gmem.h>
-#include <glib/gmessages.h>
-#include <glib/gnode.h>
 #include <glib/goption.h>
 #include <glib/gpathbuf.h>
-#include <glib/gpattern.h>
-#include <glib/gpoll.h>
 #include <glib/gprimes.h>
-#include <glib/gqsort.h>
-#include <glib/gquark.h>
-#include <glib/gqueue.h>
 #include <glib/grand.h>
-#include <glib/grcbox.h>
-#include <glib/grefcount.h>
 #include <glib/grefstring.h>
-#include <glib/gregex.h>
-#include <glib/gscanner.h>
 #include <glib/gsequence.h>
 #include <glib/gshell.h>
-#include <glib/gslice.h>
-#include <glib/gslist.h>
 #include <glib/gspawn.h>
-#include <glib/gstrfuncs.h>
-#include <glib/gstring.h>
 #include <glib/gstringchunk.h>
 #include <glib/gstrvbuilder.h>
-#include <glib/gtestutils.h>
-#include <glib/gthread.h>
 #include <glib/gthreadpool.h>
-#include <glib/gtimer.h>
-#include <glib/gtimezone.h>
 #include <glib/gtrashstack.h>
-#include <glib/gtree.h>
-#include <glib/gtypes.h>
-#include <glib/gunicode.h>
 #include <glib/guri.h>
-#include <glib/gutils.h>
 #include <glib/guuid.h>
-#include <glib/gvariant.h>
-#include <glib/gvarianttype.h>
-#include <glib/gversion.h>
-#include <glib/gversionmacros.h>
 
 #ifdef G_PLATFORM_WIN32
 #include <glib/gwin32.h>
@@ -114,8 +62,66 @@
 #include <glib/deprecated/grel.h>
 #include <glib/deprecated/gthread.h>
 
-#include <glib/glib-autocleanups.h>
+
+#endif /* NOT __EMSCRIPTEN__ */
+
+#include <glib/galloca.h>
+#include <glib/garray.h>
+#include <glib/gatomic.h>
+#include <glib/gcharset.h>
+#include <glib/ghash.h>
+#include <glib/glist.h>
+#include <glib/gmacros.h>
+#include <glib/gmem.h>
+#include <glib/gmessages.h>
+#include <glib/gquark.h>
+#include <glib/gslice.h>
+#include <glib/gslist.h>
+#include <glib/gstrfuncs.h>
+#include <glib/gthread.h>
+#include <glib/gtypes.h>
+#include <glib/gunicode.h>
+#include <glib/gmain.h>
+#include <glib/gdir.h>
+#include <glib/gconvert.h>
+#include <glib/genviron.h>
+#include <glib/gdataset.h>
+#include <glib/gscanner.h>
+#include <glib/gfileutils.h>
+#include <glib/gmarkup.h>
+#include <glib/ggettext.h>
+#include <glib/gtimer.h>
+#include <glib/giochannel.h>
+#include <glib/grcbox.h>
+#include <glib/gqueue.h>
+#include <glib/gdate.h>
+#include <glib/gdatetime.h>
+#include <glib/gtree.h>
+#include <glib/gregex.h>
+#include <glib/ghook.h>
+#include <glib/gkeyfile.h>
+#include <glib/gqsort.h>
+#include <glib/gbookmarkfile.h>
+#include <glib/gmappedfile.h>
+#include <glib/gchecksum.h>
+#include <glib/gutils.h>
+#include <glib/gnode.h>
+#include <glib/gvariant.h>
+#include <glib/gvarianttype.h>
+#include <glib/gstring.h>
+#include <glib/gerror.h>
+#include <glib/gbytes.h>
+#include <glib/gtestutils.h>
+#include <glib/gpoll.h>
+#include <glib/gtimezone.h>
+#include <glib/gversion.h>
+#include <glib/gversionmacros.h>
+#include <glib/grefcount.h>
+#include <glib/gbitlock.h>
+#include <glib/gpattern.h>
+
 #include <glib/glib-typeof.h>
+#include <glib/glib-autocleanups.h>
 
 #undef __GLIB_H_INSIDE__
 
diff --git a/glib/meson.build b/glib/meson.build
index 7d2ec17..e8f4b9d 100644
--- a/glib/meson.build
+++ b/glib/meson.build
@@ -154,26 +154,26 @@ install_headers(glib_headers, install_dir : glib_includedir)
 # when it includes GLib as a subproject
 glib_unix_h = files('glib-unix.h')
 
-glib_deprecated_headers = files(
-  'deprecated/gallocator.h',
-  'deprecated/gcache.h',
-  'deprecated/gcompletion.h',
-  'deprecated/gmain.h',
-  'deprecated/grel.h',
-  'deprecated/gthread.h',
-)
-install_headers(glib_deprecated_headers,
-  install_dir : glib_sub_includedir / 'deprecated')
+# glib_deprecated_headers = files(
+#   'deprecated/gallocator.h',
+#   'deprecated/gcache.h',
+#   'deprecated/gcompletion.h',
+#   'deprecated/gmain.h',
+#   'deprecated/grel.h',
+#   'deprecated/gthread.h',
+# )
+# install_headers(glib_deprecated_headers,
+#   install_dir : glib_sub_includedir / 'deprecated')
 
 glib_sub_headers = files(
   'glib-autocleanups.h',
   'glib-typeof.h',
   'galloca.h',
   'garray.h',
-  'gasyncqueue.h',
+  # 'gasyncqueue.h',
   'gatomic.h',
-  'gbacktrace.h',
-  'gbase64.h',
+  # 'gbacktrace.h',
+  # 'gbase64.h',
   'gbitlock.h',
   'gbookmarkfile.h',
   'gbytes.h',
@@ -189,11 +189,11 @@ glib_sub_headers = files(
   'gfileutils.h',
   'ggettext.h',
   'ghash.h',
-  'ghmac.h',
+  # 'ghmac.h',
   'ghook.h',
-  'ghostutils.h',
-  'gi18n.h',
-  'gi18n-lib.h',
+  # 'ghostutils.h',
+  # 'gi18n.h',
+  # 'gi18n-lib.h',
   'giochannel.h',
   'gkeyfile.h',
   'glist.h',
@@ -204,66 +204,66 @@ glib_sub_headers = files(
   'gmem.h',
   'gmessages.h',
   'gnode.h',
-  'goption.h',
-  'gpathbuf.h',
+  # 'goption.h',
+  # 'gpathbuf.h',
   'gpattern.h',
   'gpoll.h',
-  'gprimes.h',
+  # 'gprimes.h',
   'gqsort.h',
   'gquark.h',
   'gqueue.h',
-  'grand.h',
+  # 'grand.h',
   'grcbox.h',
   'grefcount.h',
-  'grefstring.h',
+  # 'grefstring.h',
   'gregex.h',
   'gscanner.h',
-  'gsequence.h',
-  'gshell.h',
+  # 'gsequence.h',
+  # 'gshell.h',
   'gslice.h',
   'gslist.h',
-  'gspawn.h',
+  # 'gspawn.h',
   'gstdio.h',
   'gstrfuncs.h',
-  'gstrvbuilder.h',
+  # 'gstrvbuilder.h',
   'gtestutils.h',
   'gstring.h',
-  'gstringchunk.h',
+  # 'gstringchunk.h',
   'gthread.h',
-  'gthreadpool.h',
+  # 'gthreadpool.h',
   'gtimer.h',
   'gtimezone.h',
-  'gtrashstack.h',
+  # 'gtrashstack.h',
   'gtree.h',
   'gtypes.h',
-  'guuid.h',
+  # 'guuid.h',
   'gunicode.h',
-  'guri.h',
+  # 'guri.h',
   'gutils.h',
   'gvarianttype.h',
   'gvariant.h',
   'gversion.h',
-  'gwin32.h',
+  # 'gwin32.h',
   'gprintf.h',
 )
 
 install_headers(glib_sub_headers, install_dir : glib_sub_includedir)
 
 deprecated_sources = files(
-  'deprecated/gallocator.c',
-  'deprecated/gcache.c',
-  'deprecated/gcompletion.c',
-  'deprecated/grel.c',
-  'deprecated/gthread-deprecated.c'
+  # 'deprecated/gallocator.c',
+  # 'deprecated/gcache.c',
+  # 'deprecated/gcompletion.c',
+  # 'deprecated/grel.c',
+  # 'deprecated/gthread-deprecated.c'
 )
 
 glib_sources += files(
   'garcbox.c',
   'garray.c',
-  'gasyncqueue.c',
+  # 'gasyncqueue.c',
   'gatomic.c',
-  'gbacktrace.c',
-  'gbase64.c',
+  # 'gbacktrace.c',
+  # 'gbase64.c',
   'gbitlock.c',
   'gbookmarkfile.c',
   'gbytes.c',
@@ -279,9 +279,9 @@ glib_sources += files(
   'gfileutils.c',
   'ggettext.c',
   'ghash.c',
-  'ghmac.c',
+  # 'ghmac.c',
   'ghook.c',
-  'ghostutils.c',
+  # 'ghostutils.c',
   'giochannel.c',
   'gkeyfile.c',
   'glib-init.c',
@@ -293,52 +293,52 @@ glib_sources += files(
   'gmem.c',
   'gmessages.c',
   'gnode.c',
-  'goption.c',
-  'gpathbuf.c',
+  # 'goption.c',
+  # 'gpathbuf.c',
   'gpattern.c',
   'gpoll.c',
-  'gprimes.c',
+  # 'gprimes.c',
   'gqsort.c',
   'gquark.c',
   'gqueue.c',
-  'grand.c',
+  # 'grand.c',
   'grcbox.c',
   'grefcount.c',
-  'grefstring.c',
+  # 'grefstring.c',
   'gregex.c',
   'gscanner.c',
-  'gsequence.c',
-  'gshell.c',
+  # 'gsequence.c',
+  # 'gshell.c',
   'gslice.c',
   'gslist.c',
   'gstdio.c',
   'gstrfuncs.c',
   'gstring.c',
-  'gstringchunk.c',
-  'gstrvbuilder.c',
+  # 'gstringchunk.c',
+  # 'gstrvbuilder.c',
   'gtestutils.c',
   'gthread.c',
-  'gthreadpool.c',
+  # 'gthreadpool.c',
   'gtimer.c',
   'gtimezone.c',
-  'gtrace.c',
-  'gtrace-private.h',
-  'gtranslit.c',
-  'gtrashstack.c',
+  # 'gtrace.c',
+  # 'gtrace-private.h',
+  # 'gtranslit.c',
+  # 'gtrashstack.c',
   'gtree.c',
   'guniprop.c',
   'gutf8.c',
   'gunibreak.c',
   'gunicollate.c',
   'gunidecomp.c',
-  'guri.c',
-  'guriprivate.h',
+  # 'guri.c',
+  # 'guriprivate.h',
   'gutils.c',
-  'gutilsprivate.h',
-  'guuid.c',
+  # 'gutilsprivate.h',
+  # 'guuid.c',
   'gvariant.c',
   'gvariant-core.c',
-  'gvariant-parser.c',
+  # 'gvariant-parser.c',
   'gvariant-serialiser.c',
   'gvarianttypeinfo.c',
   'gvarianttype.c',
diff --git a/gobject/gboxed.c b/gobject/gboxed.c
index 3868003..b9d60ed 100644
--- a/gobject/gboxed.c
+++ b/gobject/gboxed.c
@@ -175,10 +175,10 @@ G_DEFINE_BOXED_TYPE (GMarkupParseContext, g_markup_parse_context, g_markup_parse
 
 G_DEFINE_BOXED_TYPE (GThread, g_thread, g_thread_ref, g_thread_unref)
 G_DEFINE_BOXED_TYPE (GChecksum, g_checksum, g_checksum_copy, g_checksum_free)
-G_DEFINE_BOXED_TYPE (GUri, g_uri, g_uri_ref, g_uri_unref)
+// G_DEFINE_BOXED_TYPE (GUri, g_uri, g_uri_ref, g_uri_unref)
 
-G_DEFINE_BOXED_TYPE (GOptionGroup, g_option_group, g_option_group_ref, g_option_group_unref)
-G_DEFINE_BOXED_TYPE (GPatternSpec, g_pattern_spec, g_pattern_spec_copy, g_pattern_spec_free);
+// G_DEFINE_BOXED_TYPE (GOptionGroup, g_option_group, g_option_group_ref, g_option_group_unref)
+// G_DEFINE_BOXED_TYPE (GPatternSpec, g_pattern_spec, g_pattern_spec_copy, g_pattern_spec_free);
 
 /* This one can't use G_DEFINE_BOXED_TYPE (GStrv, g_strv, g_strdupv, g_strfreev) */
 GType
diff --git a/gthread/gthread-impl.c b/gthread/gthread-impl.c
index f85da8f..c0f7609 100644
--- a/gthread/gthread-impl.c
+++ b/gthread/gthread-impl.c
@@ -31,6 +31,8 @@
  * MT safe
  */
 
+#ifndef __EMSCRIPTEN__
+
 #include "config.h"
 
 #include <glib.h>
@@ -48,3 +50,6 @@ g_thread_init_with_errorcheck_mutexes (gpointer vtable)
   g_assert (vtable == NULL);
   g_warning ("GThread system no longer supports errorcheck mutexes.");
 }
+
+#endif /* !__EMSCRIPTEN__ */
+
diff --git a/meson.build b/meson.build
index fef4274..3a8be08 100644
--- a/meson.build
+++ b/meson.build
@@ -507,7 +507,9 @@ if cc.get_id() == 'gcc' or cc.get_id() == 'clang' or cc.get_id() == 'emscripten'
     '-Wno-unused-parameter',
     # Due to pervasive use of things like GPOINTER_TO_UINT(), we do not support
     # building with -Wbad-function-cast.
-    '-Wno-cast-function-type',
+    #'-Wno-cast-function-type',
+    '-Wbad-function-cast',
+    '-Wcast-function-type',
     # Due to function casts through (void*) we cannot support -Wpedantic:
     # https://wiki.gnome.org/Projects/GLib/CompilerRequirements#Function_pointer_conversions.
     '-Wno-pedantic',
@@ -526,7 +528,8 @@ if cc.get_id() == 'gcc' or cc.get_id() == 'clang' or cc.get_id() == 'emscripten'
     '-Wstrict-prototypes',
     # Due to pervasive use of things like GPOINTER_TO_UINT(), we do not support
     # building with -Wbad-function-cast.
-    '-Wno-bad-function-cast',
+    '-Wbad-function-cast',
+    '-Wcast-function-type',
     '-Werror=implicit-function-declaration',
     '-Werror=missing-prototypes',
     '-Werror=pointer-sign',
